import pandas as pd

def process_data():
    print("ğŸ¼ ãƒ‡ãƒ¼ã‚¿åŠ å·¥ãƒ»ä¿å­˜å‡¦ç†ã‚’é–‹å§‹ã—ã¾ã™...")

    # 1. ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿
    input_file = "python_news_multi.csv"
    try:
        df = pd.read_csv(input_file)
        print(f"\nğŸ“‚ èª­ã¿è¾¼ã¿å®Œäº†: {len(df)} ä»¶ã®ãƒ‡ãƒ¼ã‚¿")

        # ---------------------------------------------------------
        # 2. ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒ¬ãƒ³ã‚¸ãƒ³ã‚°ï¼ˆãŠæƒé™¤ï¼‰
        # ---------------------------------------------------------
        # ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã§ã¯åŒã˜URLã‚’ä½•åº¦ã‚‚å–ã£ã¦ã—ã¾ã†ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚
        # 'URL'åˆ—ãŒåŒã˜ãªã‚‰é‡è¤‡ã¨ã¿ãªã—ã¦å‰Šé™¤ã—ã¾ã™ã€‚
        # inplace=False (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ) ãªã®ã§ã€æ–°ã—ã„å¤‰æ•°ã«ä»£å…¥ã—ã¾ã™ã€‚
        df_clean = df.drop_duplicates(subset=['URL'])
        
        # é‡è¤‡ãŒã‚ã£ãŸå ´åˆã€ä»¶æ•°ãŒæ¸›ã£ã¦ã„ã‚‹ã¯ãšã§ã™
        removed_count = len(df) - len(df_clean)
        if removed_count > 0:
            print(f"ğŸ§¹ é‡è¤‡å‰Šé™¤: {removed_count} ä»¶ã®é‡è¤‡ã‚’é™¤å»ã—ã¾ã—ãŸã€‚")
        else:
            print("âœ¨ é‡è¤‡ã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚")

        # ---------------------------------------------------------
        # 3. ãƒ‡ãƒ¼ã‚¿ã®ä¸¦ã¹æ›¿ãˆï¼ˆã‚½ãƒ¼ãƒˆï¼‰
        # ---------------------------------------------------------
        # 'Title'åˆ—ã‚’åŸºæº–ã«ã€ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆé †ï¼ˆæ˜‡é †ï¼‰ã«ä¸¦ã¹æ›¿ãˆã¾ã™ã€‚
        # ascending=False ã«ã™ã‚‹ã¨é™é †ï¼ˆZ->Aï¼‰ã«ãªã‚Šã¾ã™ã€‚
        df_sorted = df_clean.sort_values(by='Title', ascending=True)
        
        print("\nğŸ‘€ ä¸¦ã¹æ›¿ãˆå¾Œã®å…ˆé ­3ä»¶:")
        print(df_sorted.head(3))

        # ---------------------------------------------------------
        # 4. ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜ï¼ˆã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆï¼‰
        # ---------------------------------------------------------
        # index=False: è¡Œç•ªå·ï¼ˆ0, 1, 2...ï¼‰ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ãªã„è¨­å®š
        # ã“ã‚Œã‚’å¿˜ã‚Œã‚‹ã¨ã€Excelã§é–‹ã„ãŸã¨ãã«è¬ã®æ•°å­—åˆ—ãŒå·¦ç«¯ã«ã¤ã„ã¦ã—ã¾ã„ã¾ã™ã€‚
        
        # CSVã¨ã—ã¦ä¿å­˜
        output_csv = "python_news_processed.csv"
        df_sorted.to_csv(output_csv, index=False, encoding='utf-8')
        print(f"\nğŸ’¾ CSVä¿å­˜å®Œäº†: {output_csv}")

        # Excelã¨ã—ã¦ä¿å­˜ (è¦: openpyxlãƒ©ã‚¤ãƒ–ãƒ©ãƒª)
        # â€»yoshiã•ã‚“ã®ç’°å¢ƒã«ã¯ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ã§ã™
        output_excel = "python_news_report.xlsx"
        df_sorted.to_excel(output_excel, index=False)
        print(f"ğŸ“Š Excelä¿å­˜å®Œäº†: {output_excel}")

    except Exception as e:
        print(f"âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {e}")

if __name__ == "__main__":
    process_data()